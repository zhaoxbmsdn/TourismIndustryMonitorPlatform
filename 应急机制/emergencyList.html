<html>

	<head>
		<title>列表</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<link rel="stylesheet" href="../style/commonStyle.css" />
		<script src="../js/jquery-3.2.1.min.js"></script>
		<style type="text/css">
			html,body{
				width: 100%;
				height: 100%;
			}
			#__01 {
				width: 100%;
				height: 100%;
				/* set font in the top-class */
				font-family: "微软雅黑";
				background: transparent;
				font-size: 14px;
				color: #56ddff;
			}
			/* 所有界面元素，包括切换页 */
			
			#main {
				width: 100%;
				height: 100%;
			}
			/* 包括标签和列表 */
			
			#mainframe {
				width: 100%;
				height: 100%;
			}
			.pageRoll {
				position: absolute;
				cursor: pointer;
			}
			#leftPage {
				float:left;
				top:45%;
				left: 4%;
				width: 11px;
				height: 50px;
				background: url(../images/images_list/pageLeft.png);

			}
			#rightPage {
				float: right;
				top:45%;
				right: 4%;
				width: 11px;
				height: 50px;
				background: url(../images/images_list/pageRight.png);
			}
			
			#leftPage:hover{
				background: url(../images/images_list/pageLeftL.png);
				animation: shine 1.5s infinite;
			}
			#rightPage:hover{
				background: url(../images/images_list/pageRightL.png);
				animation: shine 1.5s infinite;
			}
			/*
			 *  定义动画样式
			 * 	从0 - 50 - 100   效果：  正常-放大-正常
			 */
			@keyframes shine{
			    0%,100%{
			        transform:scale(1);
			        -moz-transform:scale(1);
			        -o-transform:scale(1);
			        -webkit-transform:scale(1);
			        -ms-transform:scale(1);
			        opacity:0.3
			    }
			    50%{
			        transform:scale(1.5);
			        -moz-transform:scale(1.5);
			        -o-transform:scale(1.5);
			        -webkit-transform:scale(1.5);
			        -ms-transform:scale(1.5);
			        opacity:1
			    }
			}
			
			ul {
				/* 去除列表默认的小圆点图标 */
				padding:1%;
				list-style: none;
				height: 10%;
				display: flex;
				justify-content: space-around;

			}
			
			ul li {
				display: flex;
				align-items: center;
				justify-content: center;
			}
			
			ul li.item {
				width: 24%;
				/* 定义鼠标样式 */
				cursor: pointer;
			}

			/* 选中标签时的样式
				背景使用父元素背景；
				字体颜色与表格颜色一致； 
			*/
			.labSelect {
				color: #56ddff;
				/* 字体颜色与表格一致 */
				background: transparent;
			}
			/* 未被选中的标签样式 
				背景使用图片；
				字体颜色为白色； 
			*/	
			.labNormal {
				color: white;
				/* 字体颜色为白色 */
				background: #56ddff;
			}
			
			table {
				padding:0 4% 0 4%;
				width: 100%;
				height: 90%;
				/* 字体颜色  */
				color: #56ddff;
				/* 字体大小  */
				font-size: 14px;
				/* 水平居中  */
				text-align: center;
				/* 固定表布局样式 */
				table-layout: fixed;
			}
			
			tr td{
				border-width: 1px;
				border-top-style: solid;
				border-top-color: rgba(86, 221, 255, 0.2);
				cursor: default;
			}
			
			/*
			 *   针对表头设置
			 */
			thead td{
				height: 39px;
				font-weight: bold;
			}
			
			/*
			 * 针对表格内容设置
			 */
			tbody td {
				/* 设置单元格的边框 ： 只有上边距显示*/
				overflow:hidden;
				/* clip 修剪 | ellipsis 省略号 | string 自定义文本 */
				text-overflow:ellipsis;
				/* 兼容性代码*/
				-moz-text-overflow: ellipsis;
				/* 不换行 */
				white-space: nowrap;
			}
			tbody tr td:hover{
				color: white;
			}

		</style>
	</head>

	<body>
		<div id="__01">
				<div id="main">
				<div class="pageRoll" id="leftPage"></div>
				<div id="mainframe">
					<ul>
						<li class="item labSelect" id="expert" style="color:#56ddff">
							<span class="font">专家</span>
						</li>
						<li class="item labNormal" id="material" style="color:white">
							<span class="font">救援物资</span>
						</li>
						<li class="item labNormal" id="incident" style="color:white">
							<span class="font">应急事件</span>
						</li>
						<li class="item labNormal" id="plan" style="color:white">
							<span class="font">应急预案</span>
						</li>
					</ul>
					<table id="table" cellspacing="0">
						<thead>
							<tr>
								<td >序号</td><td>名称</td><td>职称</td><td>工作单位</td><td>擅长领域</td>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td class="cell" title="1">1</td><td class="cell" title="邓德智">邓德智</td><td class="cell" title="暂无">暂无</td><td class="cell" title="教育部全国高校教师网络培训中心">教育部全国..</td><td class="cell" title="旅游企业经营管理、导游管理和旅游教育">旅游企业经..</td>
							</tr>
							<tr>
								<td class="cell" title="2">2</td><td class="cell" title="王方">王方</td><td class="cell" title="副教授">副教授</td><td class="cell" title="浙江旅游职业学院组织部部长">浙江旅游职..</td><td class="cell" title="旅游管理研究">旅游管理研..</td>
							</tr>
							<tr>
								<td class="cell" title="3">3</td><td class="cell" title="傅林放">傅林放</td><td class="cell" title="副教授">副教授</td><td class="cell" title="浙江四海方圆律师事务所">浙江四海方..</td><td class="cell" title="法律咨询">法律咨询</td>	
							</tr>
							<tr>
								<td class="cell" title="4">4</td><td class="cell" title="刘晖">刘晖</td><td class="cell" title="副教授">副教授</td><td class="cell" title="浙江省休闲学会">浙江省休闲..</td><td class="cell" title="旅游管理研究、民族旅游研究">旅游管理研..</td>
							</tr>
						</tbody>
					</table>
				</div>
				<div class="pageRoll" id="rightPage">
				</div>
			</div>
			<script type="text/javascript">
				/*
				 * 设置全局变量用于保存当天选中的元素；
				 */
				window.currentItem = "expert";
								
				/*  定义全局的分页对象  */
				var pageListener = {
					currentPage: 1,
				    pageSize: 4,
				    size:0
				};
				
				/* 注册标签切换事件  */
				var nodeList = document.getElementsByClassName("item");
				for(var i = 0; i < nodeList.length; i++) {
					nodeList[i].addEventListener("mouseover", labelStyle.bind(nodeList[i], nodeList[i], '#56ddff'), false);
					nodeList[i].addEventListener("mouseout", labelStyle.bind(nodeList[i], nodeList[i], 'white'), false);
					//注册鼠标点击事件
					nodeList[i].addEventListener("click", labelSelect.bind(nodeList[i], nodeList[i]), false);
				}
				/*  修改对应元素节点的类名 */
				function labelStyle(ele, str) {
					/* 修改前判断该元素是否已被选中；若被选中，鼠标的移入移出事件被抑制。 */
					return(ele.id == currentItem) ? "" : ele.style.color = str;
				}
				/* 点击该元素时,标签样式固定;同时，查找对应标签的内容，展示在表格中 */
				function labelSelect(ele) {
					/*
					 * 点击时触发的事件：
					 * 1、样式更新；
					 * 2、将全局对象currentItem更新为对应标签
					 * 3、表格内容置为对应标签的第一页，更新全局对象pageListener，并获取对应标签的数据库表行数；
					 */
					if(ele.id != currentItem) {   /* 判断是否当前节点是否为选中的节点 */
						/*
						 * 触发点击事件，检查自身是否为高亮元素，若是，不做操作；
					 	 * 若不是，将自身设置为高亮元素，同时，设置其他元素为普通元素；
						 */
						currentItem = ele.id;     
						var nodeList = document.getElementsByClassName("item");
						for(var i = 0; i < nodeList.length; i++) {
							nodeList[i].className = 'item labNormal';
							nodeList[i].style.color = "white";
						}
						ele.className = 'item labSelect';
						ele.style.color = "#56ddff";
					}

					/* 点击时，为该标签加载第一页前4行   */
					/*  以ajax方法请求json数据   */
					$.getJSON(
						"/front/emergencylist/home",
						{"elementId":currentItem},
						function(data) {
							/* if success ,empty their child element　*/
							$("thead").empty();
							$("tbody").empty();
							/* 标题 */
							var thd = null;
							var thr = null;
							$.each(data[0],function(key){
								thd += "<td>"+key+"</td>";
							});
							thr =$("<tr></tr>").html(thd);
							$("thead").append(thr);
							
							/* 表内容  */
							$.each(data,function(key,value){
								var tr = null; 
								var td = null;
								$.each(data[key],function(key,value){
									/* 每次遍历，新建一个td节点 */
									td += "<td class='cell' title='"+value+"'>"+cutstr(value,8)+"</td>";
								});
								tr = $("<tr></tr>").html(td); 
								/* 为tbody附加新节点 */
								$("tbody").append(tr);
							});
						}
					);
					
					pageListener.currentPage = 1;
					/*
					 * 获取对应标签在数据库中的行数
					*/
					$.get(
						"/front/emergencylist/rowcount",
						{"elementId":currentItem},
						function(data){
							pageListener.size = data;
						}
					);

				}
				
				/* 加载页面时，触发点击事件（务必保证，加载页面完成后即可加载！） */
				$("#expert").click();
				
				/* 前翻页 */
				$("#leftPage").click(function(){
					/* 若当前为第一页，不做操作；若不是第一页，则将请求前一页的数据，并输出 */
					if(pageListener.currentPage <= 1)
					{
						return;
					}
					else{
						/* 翻页动作使得当前页码-1 */
						pageListener.currentPage --;
						var maxRow = pageListener.currentPage *　pageListener.pageSize;
						/*  请求页面数据 */
						var url = "/front/emergencylist/pageroll";
						$.getJSON(
							url,
							{"elementId":currentItem,"maxRow":maxRow},
							function(data){
								/* if success ,empty their child element　*/
								$("thead").empty();
								$("tbody").empty();
								/* 标题 */
								var thd = null;
								var thr = null;
								$.each(data[0],function(key){
									thd += "<td>"+key+"</td>";
								});
								thr =$("<tr></tr>").html(thd);
								$("thead").append(thr);
								
								/* 表内容  */
								$.each(data,function(key,value){
									var tr = null; 
									var td = null;
									$.each(data[key],function(key,value){
										/* 每次遍历，新建一个td节点 */
										td += "<td class='cell' title='"+value+"'>"+cutstr(value,8)+"</td>";
									});
									tr = $("<tr></tr>").html(td); 
									/* 为tbody附加新节点 */
									$("tbody").append(tr);
								});
							}
						);
					}
					
				});
				
				/* 后翻页  */
				$("#rightPage").click(
					function(){
						/* 当前页的最大行数 */
						var nowRow = pageListener.currentPage *　pageListener.pageSize;
						/* 测试当前页是否为末页，若是，无法下翻 */
						if(nowRow > pageListener.size)
						{
							return;
						}
						else{  
							/* 下翻页动作使得当前页码+1 */
							pageListener.currentPage ++;
							/* 请求页面的最大行号 */
							var maxRow = pageListener.currentPage *　pageListener.pageSize;
							/*  请求页面数据 */
							var url = "/front/emergencylist/pageroll";
							$.getJSON(
								url,
								{"elementId":currentItem,"maxRow":maxRow},
								function(data){
									/* if success ,empty their child element　*/
									$("thead").empty();
									$("tbody").empty();
									/* 标题 */
									var thd = null;
									var thr = null;
									$.each(data[0],function(key){
										thd += "<td>"+key+"</td>";
									});
									thr =$("<tr></tr>").html(thd);
									$("thead").append(thr);
									
									/* 表内容  */
									$.each(data,function(key,value){
										var tr = null; 
										var td = null;
										$.each(data[key],function(key,value){
											/* 每次遍历，新建一个td节点 */
											td += "<td class='cell' title='"+value+"'>"+cutstr(value,8)+"</td>";
										});
										tr = $("<tr></tr>").html(td); 
										/* 为tbody附加新节点 */
										$("tbody").append(tr);
									});
								}
							);
						}
					}
				);
				/* 设置显示隐藏单元格的截取内容  */
				$(function(){
					var dialog = $("#dialog");
					$('.cell').hover(
						function(e){
							/* 获取鼠标的位置 */
							var x= e.clientX,y=e.clientY;
							dialog.css(
								{
									"left":x+"px",
									"top":y+"px",
									"fontSize":"18px"
								}
							).text($(this).attr("title")).fadeIn(30);
						},
						function(){
							dialog.hide();
						}
					);
					
				});
			</script>
		</div>
		<script>
		  /* 字符串截取方法 */
          function cutstr(str, len) {
		        var str_length = 0;
		        var str_len = 0;
		        str_cut = new String();
		        /* 传入字符串的长度 */
		        str_len = str.length;
		        for (var i = 0; i < str_len; i++) {
		            a = str.charAt(i);
		            str_length++;
		            /* escapse()对字符进行16进制编码 */
		            if (escape(a).length > 4) {
		                //中文字符经编码之后的长度大于4  
		                str_length++;
		            }
		            str_cut = str_cut.concat(a);
		            if (str_length > len) {
		                str_cut = str_cut.concat("..");
		                return str_cut;
		            }
		        }
		        //如果给定字符串小于指定长度，则返回源字符串；  
		        if (str_length <= len) {
		            return str;
		        }
		    }
          /*
           * 判断字符串是否小于指定长度
           */
          function overLength(str,len){
 
          }
     
		</script>
	</body>
</html>